{"version":3,"sources":["../src/simple-ajax-form-v5.js"],"names":["$","ithoughts","isNA","fn","extend","simpleAjaxForm","opts","defaults","validate","options","each","bindEach","$form","formopts","target","data","callback","length","html","hide","find","click","onClick","val","value","postText","getAttribute","loader","ajaxForm","beforeSubmit","jqForm","valid","removeClass","addClass","fadeTo","makeLoader","error","remove","success","responseText","statusText","xhr","jQForm","res","constructor","name","JSON","parse","str","Error","nonce_refresh","text","reload","args","window","location","href","includes","hasOwnProperty","encodeURI","redirect","setTimeout","simple_ajax_callback","$d","ready","iThoughts","v5"],"mappings":"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","file":"simple-ajax-form-v5.js","sourcesContent":["/**\n * @file Simple AJAX Form\n * @description jQuery extension to make forms AJAX enabled. Mainly used in WordPress projects\n *\n * @author Gerkin, tcbarrett\n * @copyright 2016\n * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3\n * @package iThoughts-toolbox\n *\n */\n\n'use strict';\n\n/* globals jqForm: false, iThoughts: false */\n\n( ithoughts => {\n\n\tconst {\n$, isNA,\n} = ithoughts;\n\t$.fn.extend({\n\t\t/**\n\t\t * Send a form through ajax\n\t\t * @function simpleAjaxForm\n\t\t * @memberof\texternal:jQuery\n\t\t * @param   {object} opts Options\n\t\t * @param   {boolean} [opts.validate=false] Options\n\t\t * @param   {function} [opts.callback=false] Options\n\t\t * @returns {undefined}\n\t\t */\n\t\tsimpleAjaxForm( opts ) {\n\t\t\tvar defaults = {\n\t\t\t\tvalidate: false,\n\t\t\t};\n\t\t\tvar options  = $.extend( defaults, opts );\n\t\t\tthis.each( function bindEach() {\n\t\t\t\tvar $form = $( this ),\n\t\t\t\t\tformopts = $.extend({\n\t\t\t\t\t\ttarget:   $form.data( 'target' ),\n\t\t\t\t\t\tcallback: $form.data( 'callback' ),\n\t\t\t\t\t}, options );\n\t\t\t\tif ( formopts.target && $( `#${ formopts.target }` ).length ) {\n\t\t\t\t\t$( `#${ formopts.target }` ).html( '' ).hide();\n\t\t\t\t}\n\t\t\t\t$form.find( 'button[name=\"actionB\"]' ).click( function onClick() {\n\t\t\t\t\t$form.find( '[name=\"action\"]' ).val( this.value );\n\t\t\t\t});\n\t\t\t\tvar postText = ( this.getAttribute( 'post_text' ) ? this.getAttribute( 'post_text' ) : 'Updating, please wait...' ),\n\t\t\t\t\tloader;\n\n\t\t\t\t$form.ajaxForm({\n\t\t\t\t\tbeforeSubmit() {\n\t\t\t\t\t\tif ( options.validate && !jqForm.valid()) {\n\t\t\t\t\t\t\treturn false; \n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( formopts.target && $( `#${ formopts.target }` ).length ) {\n\t\t\t\t\t\t\t$( `#${ formopts.target }` ).html( `<p>${  postText  }</p>` ).removeClass().addClass( 'clear updating' ).fadeTo( 100, 1 );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tloader = ithoughts.makeLoader();\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\terror( error ) {\n\t\t\t\t\t\tloader.remove();\n\t\t\t\t\t\tif ( formopts.target ) {\n\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-error' ).html( '<p>Form submission failed.</p>' );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( 'function' == typeof formopts.error ) {\n\t\t\t\t\t\t\tformopts.error( error );\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tsuccess( responseText, statusText, xhr, jQForm ) {\n\t\t\t\t\t\tloader.remove();\n\t\t\t\t\t\tif ( 'undefined' === typeof( jQForm )) {\n\t\t\t\t\t\t\tjQForm = xhr;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tlet res;\n\t\t\t\t\t\t\tif ( 'String' === responseText.constructor.name ) {\n\t\t\t\t\t\t\t\tres = JSON.parse( responseText );\n\t\t\t\t\t\t\t} else if ( 'Object' === responseText.constructor.name ) {\n\t\t\t\t\t\t\t\tres = responseText;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow `Unhandled type ${  typeof responseText }`;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( '0' === res || !res ) {\n\t\t\t\t\t\t\t\tconst str = 'Server did not respond anything';\n\t\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-warning' ).html( `<p>${ str }</p>` );\n\n\t\t\t\t\t\t\t\tif ( 'function' == typeof formopts.error ) {\n\t\t\t\t\t\t\t\t\tformopts.error( new Error( str ));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif ( typeof res.success != 'undefined' && res.success != null && typeof res.data != 'undefined' && res.data != null ) { // handle wp_send_json_{success|error}\n\t\t\t\t\t\t\t\t\tres.data.valid = res.success;\n\t\t\t\t\t\t\t\t\tres = res.data;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// If a nonce refresh token is present, try to update it\n\t\t\t\t\t\t\t\tif ( res.nonce_refresh ) {\n\t\t\t\t\t\t\t\t\t$form.find( '[name=\"_wpnonce\"]' ).val( res.nonce_refresh );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Handle raw response\n\t\t\t\t\t\t\t\tif ( !res.valid ) {\n\t\t\t\t\t\t\t\t\tif ( formopts.target && $( `#${ formopts.target }` ).length ) {\n\t\t\t\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-error' ).html( res.text );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif ( res.reload ) {\n\t\t\t\t\t\t\t\t\t\tlet args;\n\t\t\t\t\t\t\t\t\t\tif ( window.location.href.includes( '?' )) {\n\t\t\t\t\t\t\t\t\t\t\targs = '&';\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\targs = '?';\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif ( res.hasOwnProperty( 'text' ) && !isNA( res.text )) {\n\t\t\t\t\t\t\t\t\t\t\targs += `json-res-txt=${  encodeURI( res.text ) }`;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\twindow.location.href += args;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif ( formopts.target && $( `#${ formopts.target }` ).length ) {\n\t\t\t\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-success' ).html( res.text );\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif ( res.redirect ) {\n\t\t\t\t\t\t\t\t\t\tif ( res.text ) {\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\t\twindow.location.href = res.redirect;\n\t\t\t\t\t\t\t\t\t\t\t}, 2500 );\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\twindow.location.href = res.redirect;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tif ( 'function' == typeof $form[0].simple_ajax_callback ) {\n\t\t\t\t\t\t\t\t\t\t$form[0].simple_ajax_callback( res );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( 'function' == typeof formopts.callback ) {\n\t\t\t\t\t\t\t\t\t\tformopts.callback( res );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch ( error ) {\n\t\t\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-error' ).html( '<p>Error with received data</p>' );\n\t\t\t\t\t\t\t\t\tif ( 'function' == typeof formopts.error ) {\n\t\t\t\t\t\t\t\t\t\tformopts.error( error );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch ( error ) {\n\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-error' ).html( '<p>Invalid server response</p>' );\n\t\t\t\t\t\t\tif ( 'function' == typeof formopts.error ) {\n\t\t\t\t\t\t\t\tformopts.error( error );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t});\n\n\tithoughts.$d.ready(() => {\n\t\t$( '.simpleajaxform' ).simpleAjaxForm();\n\t});\n})( iThoughts.v5 );\n"]}