{"version":3,"sources":["../src/simple-ajax-form.js"],"names":["w","$","$d","isNA","makeLoader","DEFAULT_FORM_OPTS","validate","fn","extend","simpleAjaxForm","opts","options","each","bindEach","$form","formopts","target","data","callback","length","html","hide","find","click","onClick","val","value","postText","getAttribute","loader","ajaxForm","beforeSubmit","jqForm","valid","removeClass","addClass","fadeTo","error","remove","success","responseText","statusText","xhr","jQForm","res","constructor","name","JSON","parse","str","Error","nonce_refresh","text","reload","args","location","href","includes","hasOwnProperty","encodeURI","redirect","setTimeout","simple_ajax_callback","ready"],"mappings":"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","file":"simple-ajax-form.js","sourcesContent":["/**\n * @file Simple AJAX Form\n * @description jQuery extension to make forms AJAX enabled. Mainly used in WordPress projects\n *\n * @author Gerkin, tcbarrett\n * @copyright 2016\n * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3\n * @package iThoughts-toolbox\n *\n */\n\n'use strict';\n\n/* globals jqForm: false */\n\nconst {\n\tw, $, $d, isNA, makeLoader,\n} = require( 'ithoughts-core' );\n\nconst DEFAULT_FORM_OPTS = {\n\tvalidate: false,\n};\n\n$.fn.extend({\n\t/**\n\t\t * Send a form through ajax.\n   * \n\t\t * @function simpleAjaxForm\n\t\t * @memberof\texternal:jQuery\n\t\t * @param   {Object} opts - Options.........................................................................................................................................................................................\n\t\t * @param   {boolean} [opts.validate=false] Options\n\t\t * @param   {Function} [opts.callback=false] Options\n\t\t * @returns {undefined}\n\t\t */\n\tsimpleAjaxForm( opts ) {\n\t\tvar options  = $.extend( DEFAULT_FORM_OPTS, opts );\n\t\tthis.each( function bindEach() {\n\t\t\tconst $form = $( this );\n\t\t\tconst formopts = $.extend({\n\t\t\t\ttarget:   $form.data( 'target' ),\n\t\t\t\tcallback: $form.data( 'callback' ),\n\t\t\t}, options );\n\t\t\tif ( formopts.target && $( `#${ formopts.target }` ).length ) {\n\t\t\t\t$( `#${ formopts.target }` ).html( '' ).hide();\n\t\t\t}\n\t\t\t$form.find( 'button[name=\"actionB\"]' ).click( function onClick() {\n\t\t\t\t$form.find( '[name=\"action\"]' ).val( this.value );\n\t\t\t});\n\t\t\tconst postText = ( this.getAttribute( 'post_text' ) ? this.getAttribute( 'post_text' ) : 'Updating, please wait...' );\n\t\t\tlet loader;\n\n\t\t\t$form.ajaxForm({\n\t\t\t\tbeforeSubmit() {\n\t\t\t\t\tif ( options.validate && !jqForm.valid()) {\n\t\t\t\t\t\treturn false; \n\t\t\t\t\t}\n\t\t\t\t\tif ( formopts.target && $( `#${ formopts.target }` ).length ) {\n\t\t\t\t\t\t$( `#${ formopts.target }` ).html( `<p>${  postText  }</p>` ).removeClass().addClass( 'clear updating' ).fadeTo( 100, 1 );\n\t\t\t\t\t}\n\t\t\t\t\tloader = makeLoader();\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\terror( error ) {\n\t\t\t\t\tloader.remove();\n\t\t\t\t\tif ( formopts.target ) {\n\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-error' ).html( '<p>Form submission failed.</p>' );\n\t\t\t\t\t}\n\t\t\t\t\tif ( 'function' == typeof formopts.error ) {\n\t\t\t\t\t\tformopts.error( error );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsuccess( responseText, statusText, xhr, jQForm ) {\n\t\t\t\t\tloader.remove();\n\t\t\t\t\tif ( 'undefined' === typeof ( jQForm )) {\n\t\t\t\t\t\tjQForm = xhr;\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet res;\n\t\t\t\t\t\tif ( 'String' === responseText.constructor.name ) {\n\t\t\t\t\t\t\tres = JSON.parse( responseText );\n\t\t\t\t\t\t} else if ( 'Object' === responseText.constructor.name ) {\n\t\t\t\t\t\t\tres = responseText;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow `Unhandled type ${  typeof responseText }`;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( '0' === res || !res ) {\n\t\t\t\t\t\t\tconst str = 'Server did not respond anything';\n\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-warning' ).html( `<p>${ str }</p>` );\n\n\t\t\t\t\t\t\tif ( 'function' == typeof formopts.error ) {\n\t\t\t\t\t\t\t\tformopts.error( new Error( str ));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif ( typeof res.success != 'undefined' && res.success != null && typeof res.data != 'undefined' && res.data != null ) { // handle wp_send_json_{success|error}\n\t\t\t\t\t\t\t\tres.data.valid = res.success;\n\t\t\t\t\t\t\t\tres = res.data;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// If a nonce refresh token is present, try to update it\n\t\t\t\t\t\t\tif ( res.nonce_refresh ) {\n\t\t\t\t\t\t\t\t$form.find( '[name=\"_wpnonce\"]' ).val( res.nonce_refresh );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Handle raw response\n\t\t\t\t\t\t\tif ( !res.valid ) {\n\t\t\t\t\t\t\t\tif ( formopts.target && $( `#${ formopts.target }` ).length ) {\n\t\t\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-error' ).html( res.text );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif ( res.reload ) {\n\t\t\t\t\t\t\t\t\tlet args;\n\t\t\t\t\t\t\t\t\tif ( w.location.href.includes( '?' )) {\n\t\t\t\t\t\t\t\t\t\targs = '&';\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\targs = '?';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( res.hasOwnProperty( 'text' ) && !isNA( res.text )) {\n\t\t\t\t\t\t\t\t\t\targs += `json-res-txt=${  encodeURI( res.text ) }`;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tw.location.href += args;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ( formopts.target && $( `#${ formopts.target }` ).length ) {\n\t\t\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-success' ).html( res.text );\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ( res.redirect ) {\n\t\t\t\t\t\t\t\t\tif ( res.text ) {\n\t\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\tw.location.href = res.redirect;\n\t\t\t\t\t\t\t\t\t\t}, 2500 );\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tw.location.href = res.redirect;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tif ( 'function' == typeof $form[0].simple_ajax_callback ) {\n\t\t\t\t\t\t\t\t\t$form[0].simple_ajax_callback( res );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ( 'function' == typeof formopts.callback ) {\n\t\t\t\t\t\t\t\t\tformopts.callback( res );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch ( error ) {\n\t\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-error' ).html( '<p>Error with received data</p>' );\n\t\t\t\t\t\t\t\tif ( 'function' == typeof formopts.error ) {\n\t\t\t\t\t\t\t\t\tformopts.error( error );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch ( error ) {\n\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-error' ).html( '<p>Invalid server response</p>' );\n\t\t\t\t\t\tif ( 'function' == typeof formopts.error ) {\n\t\t\t\t\t\t\tformopts.error( error );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t},\n});\n\n$d.ready(() => {\n\t$( '.simpleajaxform' ).simpleAjaxForm();\n});\n"]}